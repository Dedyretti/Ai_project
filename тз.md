# Техническое задание

# 1. Введение
## 1.1. Цель документа

Этот документ описывает цели, функциональные и нефункциональные требования, а также план разработки десктопного приложения "Poker Mentor". Приложение предназначено для помощи игрокам в покер в обучении, анализе своей игры и совершенствовании навыков.

## 1.2. Целевая аудитория
- Начинающие покеристы, желающие изучить основы.

- Любители, стремящиеся повысить свой уровень игры.

- Профессиональные игроки, нуждающиеся в глубоком анализе своих раздач и статистики.

## 1.3. Описание продукта
"Poker Mentor" — это приложение, которое объединяет в себе:

- Интерактивное обучение: Курсы, симуляторы и тесты.

- Анализ игр: Загрузка и разбор истории раздач (Hand History) с популярных покер-румов.

- Статистику и отчеты: Детальная аналитика по результатам, выявление слабых и сильных сторон.

- Тренировочные режимы: Отработка навыков в смоделированных ситуациях.

# 2. Общее описание
## 2.1. Функции продукта (Краткий обзор)

- Система пользователей: Регистрация, авторизация, профиль.

- Модуль обучения: Текстовые уроки, видео, интерактивные тесты и симуляторы.

- Модуль анализа: Парсинг Hand History, отображение раздач в виде реплея, инструменты для разбора ошибок.

- Статистический модуль: Графики, диаграммы, ключевые показатели эффективности (KPI).

- Тренировочный модуль: Решение покерных спотов (задач), игра против ИИ.

- Личный кабинет: Настройки, прогресс обучения, история анализов.

# Техническая архитектура 

## 1.1. Клиентская часть : 

- Платформа: Python + Tkinter/PyQt6/kKivy для нативного UI

- Альтернатива: Electron с Python бэкендом (через Flask/FastAPI)

- Язык программирования: Python 3.9+

- GUI фреймворк: PyQt6 для профессионального интерфейса или kivy если в дальнейшем понадобится кросплатформенность 

- Асинхронность: asyncio + aiohttp для работы с API

## 1.2. Серверная часть : 

- Backend API: FastAPI для внутреннего REST API

- База данных: SQLite для локального хранения (с миграцией на PostgreSQL при масштабировании)

- Векторная БД: ChromaDB или FAISS для эмбеддингов

- Кэширование: Redis (опционально) или in-memory cache

## 1.3. Интеграция с ИИ-системами :

- Основной AI провайдер: OpenAI GPT-4 API через официальную библиотеку

- Резервный провайдер: Anthropic Claude API

- Локальные модели: Ollama API + модели Mistral/Llama 3

- Эмбеддинги: sentence-transformers для локальных эмбеддингов

- ML библиотеки: scikit-learn, pandas для анализа данных

# Технические модули 

## 2.1. Модуль интеграции ИИ-ассистента

```bash
src/ai_assistant/
├── api/
│   ├── openai_client.py
│   ├── anthropic_client.py
│   ├── ollama_client.py
│   └── api_manager.py
├── prompts/
│   ├── poker_analysis.py
│   ├── hand_evaluation.py
│   ├── strategy_advice.py
│   └── learning_tutor.py
├── context/
│   ├── memory_manager.py
│   ├── context_builder.py
│   └── session_manager.py
├── chat/
│   ├── chat_interface.py
│   └── message_handler.py
└── knowledge/
    ├── poker_knowledge_base.py
    └── embedding_service.py

```


## 2.2. Модуль анализа Hand History

```bash 
src/hand_history/
├── parsers/
│   ├── base_parser.py
│   ├── pokerstars_parser.py
│   ├── ggpoker_parser.py
│   └── ipoker_parser.py
├── analyzer/
│   ├── hand_analyzer.py
│   ├── statistics_calculator.py
│   └── leak_detector.py
├── replay/
│   ├── replay_engine.py
│   └── visualizer.py
└── database/
    ├── models.py
    └── repository.py
```


## 2.3. Модуль обучения

```bash 
src/learning/
├── courses/
│   ├── course_manager.py
│   ├── lesson_loader.py
│   └── progress_tracker.py
├── simulators/
│   ├── preflop_simulator.py
│   ├── postflop_simulator.py
│   └── icm_trainer.py
├── quizzes/
│   ├── quiz_engine.py
│   └── question_bank.py
└── spots/
    ├── spot_trainer.py
    └── spot_evaluator.py
```
# Технические требования и зависимости

## 3.1. Основные зависимости Python

```bash
# Основные фреймворки
fastapi>=0.104.0
uvicorn>=0.24.0
pydantic>=2.0.0
sqlalchemy>=2.0.0
alembic>=1.12.0

# GUI
pyqt6>=6.6.0
qt-material>=2.14

# AI/ML
openai>=1.3.0
anthropic>=0.7.0
sentence-transformers>=2.2.0
chromadb>=0.4.0
numpy>=1.24.0
pandas>=2.0.0
scikit-learn>=1.3.0

# Утилиты
aiohttp>=3.9.0
requests>=2.31.0
python-multipart>=0.0.6
python-dateutil>=2.8.0
```


## 3.2. Конфигурация ИИ-ассистента

```python 
# config/ai_config.py
AI_CONFIG = {
    "openai": {
        "model": "gpt-4-1106-preview",
        "temperature": 0.7,
        "max_tokens": 4000
    },
    "anthropic": {
        "model": "claude-3-sonnet-20240229",
        "max_tokens": 4000
    },
    "local": {
        "model": "mistral:7b-instruct",
        "base_url": "http://localhost:11434"
    },
    "context_window": 8000,
    "fallback_strategy": "openai->anthropic->local"
}
```
#  API спецификации
## 4.1. Внутреннее REST API (FastAPI)

```py 
# Основные эндпоинты
@app.post("/api/ai/analyze-hand")
async def analyze_hand(hand_history: str, context: AnalysisContext):
    """Анализ раздачи с ИИ"""

@app.post("/api/ai/chat")
async def chat_with_ai(message: ChatMessage, session_id: str):
    """Чат с ИИ-ассистентом"""

@app.get("/api/hands/{hand_id}/replay")
async def get_hand_replay(hand_id: str):
    """Получить реплей раздачи"""

@app.post("/api/learning/quiz/evaluate")
async def evaluate_quiz_answer(question_id: str, answer: str):
    """Оценка ответа на квиз"""
```


## 4.2. Интеграция с внешними API

```py
# Интеграция с покерными румами
SUPPORTED_ROOMS = {
    "pokerstars": {
        "hand_history_path": "C:/PokerStars/HandHistory",
        "format": "txt"
    },
    "ggpoker": {
        "hand_history_path": "C:/GGPoker/HH",
        "format": "txt"
    }
}
```

# Технические особенности реализации 
## 5.1. Работа с памятью и контекстом


```py 
class AIContextManager:
    def __init__(self):
        self.conversation_history = []
        self.poker_knowledge_base = PokerKnowledgeBase()
        
    async def build_context(self, hand_data: dict, user_query: str) -> str:
        """Построение контекста для ИИ включая историю рук, статистику и стиль игры"""
        pass
        
    def manage_token_usage(self, context: str) -> str:
        """Управление использованием токенов для длинных контекстов"""
        pass
```
## 5.2. Обработка Hand History

```py 
class HandHistoryProcessor:
    def __init__(self):
        self.parsers = self._load_parsers()
        
    async def process_file(self, file_path: str) -> HandAnalysis:
        """Парсинг и анализ файла с историей рук"""
        hand_data = await self.parse_hand_history(file_path)
        ai_analysis = await self.analyze_with_ai(hand_data)
        return self.combine_analysis(hand_data, ai_analysis)
```

# Требования к развертыванию
## 6.1. Системные требования

- ОС: Windows 10/11, macOS 10.15+, Ubuntu 18.04+

- Память: 8 GB RAM минимум, 16 GB рекомендовано

- Процессор: 4-ядерный CPU

- Диск: 2 GB свободного места

- Интернет: Для работы с облачными AI API



## 6.2. Установка и запуск

```bash 
# Создание виртуального окружения
python -m venv poker_mentor_env
source poker_mentor_env/bin/activate  # Linux/Mac
poker_mentor_env\Scripts\activate    # Windows

# Установка зависимостей
pip install -r requirements.txt

# Запуск приложения
python src/main.py
```

# Мониторинг и логирование
## 7.1. Система логирования

```py 
import logging

logging.config.dictConfig({
    'version': 1,
    'handlers': {
        'file': {
            'class': 'logging.handlers.RotatingFileHandler',
            'filename': 'logs/poker_mentor.log',
            'maxBytes': 10485760,  # 10MB
            'backupCount': 5
        }
    },
    'root': {
        'level': 'INFO',
        'handlers': ['file']
    }
})
```
